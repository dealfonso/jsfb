/* Copyright 2024 Carlos A. (https://github.com/dealfonso); License: http://www.apache.org/licenses/LICENSE-2.0 */
(function(exports){if(typeof exports==="undefined"){exports=window}class FBDropdown{static defaults={closeOnOutsideClick:true,openingSide:"auto",openingSideToPage:false};extractOptions(){let t={};for(let e in FBDropdown.defaults){if(this.dropdown.dataset[e]!==undefined){t[e]=this.dropdown.dataset[e]}}return t}constructor(e,t={}){if(e._fbDropdown!==undefined){return e._fbDropdown}this.dropdown=e;let i=Object.assign({},FBDropdown.defaults,this.extractOptions(),t);this.options=i;this.toggle=e.querySelector(".fb-dropdown-toggle");this.content=e.querySelector(".fb-dropdown-content");this.isOpen=false;this.documentClickHandler=!this.options.closeOnOutsideClick?null:e=>{if(!this.dropdown.contains(e.target)){this.hide()}};this.optionsInMenu=e.querySelectorAll(".fb-dropdown-content"),this.closeHandler=e=>{this.hide();e.stopPropagation()};this.toggle.addEventListener("click",e=>{this.toggleOpen();e.stopPropagation()});this.optionsInMenu.forEach(e=>{e.addEventListener("click",this.closeHandler)});if(this.options.closeOnOutsideClick){document.addEventListener("click",this.documentClickHandler)}e._fbDropdown=this}show(){let n=false;switch(this.options.openingSide){case"left":n=true;break;case"right":n=false;break;case"auto":default:let e;if(this.options.openingSideToPage){e=document.body.getBoundingClientRect()}else{e=this.dropdown.parentElement.getBoundingClientRect()}let t=this.toggle.getBoundingClientRect();this.content.style.removeProperty("right");this.content.style.removeProperty("left");this.content.style.removeProperty("top");this.content.style.removeProperty("bottom");let i=this.content.getBoundingClientRect();let s=e.right-(t.left+i.width);let l=t.right-i.width-e.left;if(l>s){n=true}break}if(n){this.content.style.right="0"}this.content.classList.add("show");this.isOpen=true}hide(){this.content.classList.remove("show");this.isOpen=false}toggleOpen(){this.isOpen=!this.isOpen;if(this.isOpen){this.show()}else{this.hide()}}}FBDropdown.version="1.0.0";if(typeof exports==="undefined"){exports=window}class FileBrowser{static extensionToIcon={txt:"fas fa-file-alt",pdf:"fas fa-file-pdf",doc:"fas fa-file-word",docx:"fas fa-file-word",xls:"fas fa-file-excel",xlsx:"fas fa-file-excel",ppt:"fas fa-file-powerpoint",pptx:"fas fa-file-powerpoint",jpg:"fas fa-file-image",jpeg:"fas fa-file-image",png:"fas fa-file-image",gif:"fas fa-file-image",mp3:"fas fa-file-audio",wav:"fas fa-file-audio",mov:"fas fa-file-video",mp4:"fas fa-file-video",avi:"fas fa-file-video",zip:"fas fa-file-archive",rar:"fas fa-file-archive",tar:"fas fa-file-archive",gz:"fas fa-file-archive","7z":"fas fa-file-archive",exe:"fas fa-file-executable",js:"fas fa-file-code",css:"fas fa-file-code",html:"fas fa-file-code",php:"fas fa-file-code",py:"fas fa-file-code",java:"fas fa-file-code",c:"fas fa-file-code",cpp:"fas fa-file-code",h:"fas fa-file-code",hpp:"fas fa-file-code",json:"fas fa-file-code",xml:"fas fa-file-code",csv:"fas fa-file-excel",file:"fas fa-file",html:"fas fa-file-code",md:"fas fa-file-alt"};static defaultOptions={mode:"list",orderColumn:"filename",orderAscending:true,hideZeroSize:true,allowDuplicates:false,separateFoldersFromFiles:true,enableSelection:true,allowMultipleSelection:true,onFileClick:e=>{},onFileDoubleClick:e=>{},onSelectionUpdate:e=>{},overlayGenerator:e=>null,onHtmlCreated:(e,t,i)=>{},onFileDownload:null,onFileDelete:null,onFileRename:null,onFileCopy:null,onFileMove:null,onFileShare:null,onFileInfo:null,extensionToIcon:FileBrowser.extensionToIcon,customContextMenu:null};static mutationObserver=new MutationObserver(e=>{FileBrowser.fromDOM(document.querySelectorAll(".fb-filebrowser"))});static fromDOM(e,i={}){let s=[];if(e instanceof Element){e=[e]}else if(e instanceof NodeList){e=Array.from(e)}else if(!Array.isArray(e)){throw new Error("Invalid type of objects")}if(e.length===0){return null}e.forEach(e=>{let t=e._fbFileBrowser??null;if(t===null){t=new FileBrowser(e,i)}s.push(t)});if(e.length===1){return s[0]}return s}_lastFileSelected=null;constructor(e,t={}){if(e instanceof Element){}else if(typeof e==="string"){e=document.querySelector(e)}else{throw new Error("Invalid element")}if(e._fbFileBrowser!==undefined){if(Object.keys(t).length>0){console.warn("Options are being ignored as the FileBrowser already exists. Please use updateOptions instead")}return e._fbFileBrowser}let i=FileBrowser._optionsFromDOM(e,FileBrowser.defaultOptions,"fb");this.options=Object.assign({},FileBrowser.defaultOptions,i,t);this.mode=null;this.filelist=[];this._elementsPlace=null;this._htmlElement=e;this._evaluateOptions();e._fbFileBrowser=this;let s=e.querySelectorAll("fb-file");let l=Array.from(s).map(e=>{const t={filename:"",size:0,modified:null,isDirectory:false,type:"file",previewUrl:null,icon:null,data:null};let i=FileBrowser._optionsFromDOM(e,t,"fb");return Object.assign({},{filename:e.textContent,size:0,modified:null},i)});this.render();l.forEach(e=>{if(e.isDirectory){this.addFolder(e.filename,e.modified,e)}else{this.addFile(e.filename,e.size,e.modified,e)}})}updateOptions(e,t=false){let i=Object.assign({},this.options);if(t){this.options=Object.assign({},FileBrowser.defaultOptions,e)}else{this.options=Object.assign({},this.options,e)}this._evaluateOptions();let s=false;for(let e in this.options){if(typeof this.options[e]==="function"){continue}if(this.options[e]!=i[e]){s=true;break}}if(!s){return}this.render()}getFiles(){return this.filelist}getSelectedFiles(){return this.filelist.filter(e=>e.selected)}clearSelection(){this.filelist.forEach(e=>e.unselect())}_setMode(e){switch(e.toLowerCase()){case"list":case"grid":case"preview":this.mode=e;break;default:throw new Error("Invalid mode")}}_addFile(t,e={}){if(!this.options.allowDuplicates){let e=this.filelist.find(e=>e.filename===t);if(e!==undefined){throw new Error("File already exists")}}t=`${t}`;e=Object.assign({},{contextMenu:this.options.customContextMenu,icon:e.isDirectory?"fa-regular fa-folder":this._filenameToIcon(t),type:t.split(".").pop().toLowerCase(),onFileClick:(l,i)=>{if(this.options.enableSelection){let e=this.filelist.filter(e=>e.selected).map(e=>this.filelist.indexOf(e));if(!this.options.allowMultipleSelection){this.clearSelection();l.select()}else{if(!i.shiftKey&&!i.ctrlKey&&!i.metaKey){this.clearSelection();l.select();this._lastFileSelected=l}if(i.shiftKey){if(this._lastFileSelected!==null){let e=this.filelist.indexOf(this._lastFileSelected);let t=this.filelist.indexOf(l);let i=Math.min(e,t);let s=Math.max(e,t);for(let e=i;e<=s;e++){this.filelist[e].select()}}else{l.select()}this._lastFileSelected=l}else{if(i.ctrlKey||i.metaKey){l.toggleSelect();if(l.selected){this._lastFileSelected=l}else{this._lastFileSelected=null}}}}let t=this.filelist.filter(e=>e.selected).map(e=>this.filelist.indexOf(e));if(e.join(",")!==t.join(",")){this.options.onSelectionUpdate(this.getSelectedFiles())}}this.options.onFileClick(l,i)},onFileDoubleClick:this.options.onFileDoubleClick},e);let i=new FileInFileBrowser(t,e);let s=this._findNextFile(i);if(s!==null){this.filelist.splice(this.filelist.indexOf(s),0,i);this._placeFile(this._renderFile(i),s)}else{this.filelist.push(i);this._placeFile(this._renderFile(i))}return i}addFile(e,t,i,s={}){return this._addFile(e,Object.assign({},s,{isDirectory:false,size:t,modified:i}))}addOrUpdateFile(e,t={}){let i=this.findFile(e);t=Object.assign({},t,{isDirectory:false,type:e.split(".").pop().toLowerCase()});if(i===null){return this.addFile(e,0,new Date,t)}if(i.isDirectory){throw new Error("Existing file is not a file")}return this.updateFile(e,t)}updateFile(e,t={}){let i=this.findFile(e);if(i===null){throw new Error("File not found")}let s=i._htmlElement;if(i.compareOptions(t)){return i}s.remove();i.update(t);let l=this._findNextFile(i);if(l!==null){this.filelist.splice(this.filelist.indexOf(l),0,i);this._placeFile(this._renderFile(i),l)}else{this.filelist.push(i);this._placeFile(this._renderFile(i))}return i}addFolder(e,t,i={}){return this._addFile(e,Object.assign({},{icon:"fa-regular fa-folder",size:null},i,{isDirectory:true,modified:t,type:"folder"}))}updateFolder(e,t={}){let i=this.findFile(e);if(i===null){throw new Error("Folder not found")}if(!i.isDirectory){throw new Error("Existing file is not a folder")}t=Object.assign({},t,{isDirectory:true,type:"folder"});let s=i._htmlElement;if(i.compareOptions(t)){return i}s.remove();i.update(t);let l=this._findNextFile(i);if(l!==null){this.filelist.splice(this.filelist.indexOf(l),0,i);this._placeFile(this._renderFile(i),l)}else{this.filelist.push(i);this._placeFile(this._renderFile(i))}return i}addOrUpdateFolder(e,t={}){let i=this.findFile(e);t=Object.assign({},t,{isDirectory:true,type:"folder"});if(i===null){return this.addFolder(e,new Date,t)}if(!i.isDirectory){throw new Error("Existing file is not a folder")}return this.updateFolder(e,t)}findFile(t){let e=this.filelist.find(e=>e.filename===t);if(e===undefined){return null}return e}findFiles(e){let t=new RegExp(e.replace(/\*/g,".*").replace(/\?/g,"."),"i");return this.filelist.filter(e=>t.test(e.filename))}removeFile(t){if(t instanceof FileInFileBrowser){let e=this.filelist.indexOf(t);if(e>=0){this.filelist.splice(e,1)}}else if(typeof t==="string"){t=this.findFile(t);if(t!==null){let e=this.filelist.indexOf(t);if(e>=0){this.filelist.splice(e,1)}}}this.render()}forEachFile(e){this.filelist.forEach(e)}render(e=null){if(e!==null){this._setMode(e)}this._htmlElement.innerHTML="";let t=null;switch(this.mode){case"list":t=this._createList();break;case"grid":t=this._createGrid();break;case"preview":t=this._createPreview();break}this._renderFiles();this._htmlElement.appendChild(t);if(this.mode==="list"){let e=new ResizableColumnTable(t,{sortableHeaders:true,onSort:(e,t)=>{switch(e.textContent.trim().toLowerCase()){case"name":this.sort("filename",t=="asc");break;case"size":this.sort("size",t=="asc");break;case"modified":this.sort("modified",t=="asc");break}}});switch(this.options.orderColumn){case"filename":e.setOrder(0,this.options.orderAscending?"asc":"desc");break;case"size":e.setOrder(1,this.options.orderAscending?"asc":"desc");break;case"modified":e.setOrder(2,this.options.orderAscending?"asc":"desc");break}}this._lastFileSelected=null}sort(e,t){let i=this._getSortFunction(e,t);this.options.orderColumn=e;this.options.orderAscending=t;this.filelist.sort(i);this._elementsPlace.innerHTML="";this._renderFiles()}clear(){this.filelist=[];this.render()}static _optionsFromDOM(s,e={},l="fb"){let n={};for(let i in e){let t=l+i[0].toUpperCase()+i.slice(1);if(s.dataset[t]!==undefined){let e=s.dataset[t];if(e==="true"||e==="false"){n[i]=e==="true"}else if(!isNaN(parseFloat(e))&&parseFloat(e).toString()==e){n[i]=parseFloat(e)}else{n[i]=e}}}return n}_generateContextMenu(){let e={};if(this.options.onFileDownload instanceof Function){e["download"]={label:"Download",handler:this.options.onFileDownload}}if(this.options.onFileDelete instanceof Function){e["delete"]={label:"Delete",handler:this.options.onFileDelete}}if(this.options.onFileRename instanceof Function){e["rename"]={label:"Rename",handler:this.options.onFileRename}}if(this.options.onFileCopy instanceof Function){e["copy"]={label:"Copy",handler:this.options.onFileCopy}}if(this.options.onFileMove instanceof Function){e["move"]={label:"Move",handler:this.options.onFileMove}}if(this.options.onFileShare instanceof Function){e["share"]={label:"Share",handler:this.options.onFileShare}}if(this.options.onFileInfo instanceof Function){e["info"]={label:"Info",handler:this.options.onFileInfo}}if(Object.keys(e).length>0){e.__generated=true;return e}return null}_evaluateOptions(){this._setMode(this.options.mode);this.options.onHtmlCreated=this.options.onHtmlCreated?.bind(this);let e=["onFileClick","onFileDoubleClick","onSelectionUpdate","onFileDownload","onFileDelete","onFileRename","onFileCopy","onFileMove","onFileShare","onFileInfo"];e.forEach(e=>{this.options[e]=covertCallback(this.options[e],this)});if(this.options.customContextMenu===null||this.options.customContextMenu.__generated){this.options.customContextMenu=this._generateContextMenu()}if((this.options.extensionToIcon??null)===null){this.options.extensionToIcon={}}if(typeof this.options.extensionToIcon!=="object"){throw new Error("Invalid extensionToIcon")}}_placeFile(e,t=null){if(t!==null){t._htmlElement.insertAdjacentElement("beforebegin",e._htmlElement)}else{this._elementsPlace.appendChild(e._htmlElement)}return e}_renderFile(e){let t=null;switch(this.mode){case"list":t=e.tableRow();break;case"grid":t=e.gridElement(this.options.overlayGenerator);break;case"preview":t=e.previewElement(this.options.overlayGenerator);break}if(this.options.hideZeroSize&&e.size===0){t.querySelector(".fb-file-size").innerHTML=""}this.options.onHtmlCreated?.call(this,t,e,this.mode);return e}_getDirectoryAndShowFirstComparisonFunctions(){if(this.options.separateFoldersFromFiles){return function(e,t){if(e.isDirectory&&!t.isDirectory){return-1}if(!e.isDirectory&&t.isDirectory){return 1}if(e.showFirst&&!t.showFirst){return-1}if(!e.showFirst&&t.showFirst){return 1}return 0}}else{return function(e,t){if(e.showFirst&&!t.showFirst){return-1}if(!e.showFirst&&t.showFirst){return 1}return 0}}}_getSortFunction(e=null,t=null){if(e===null){e=this.options.orderColumn}if(t===null){t=this.options.orderAscending}let s=null;let l=this._getDirectoryAndShowFirstComparisonFunctions();switch(e){case"filename":s=(e,t)=>e.filename.localeCompare(t.filename);break;case"size":s=(e,t)=>e.size-t.size;break;case"modified":s=(e,t)=>{if(e.modified===null){return-1}if(t.modified===null){return 1}return e.modified.getTime()-t.modified.getTime()};break;case"type":s=(e,t)=>e.type.localeCompare(t.type);break;default:throw new Error("Invalid column")}let n=t?1:-1;return(e,t)=>{let i=l(e,t);if(i!==0){return i}return n*s(e,t)}}_findNextFile(t){let i=this._getSortFunction();if(this.filelist.length==0){return null}for(let e=0;e<this.filelist.length;e++){if(i(t,this.filelist[e])<0){return this.filelist[e]}}return null}_filenameToIcon(e){let t=e.split(".").pop().toLowerCase();if(this.options.extensionToIcon instanceof Function){return this.options.extensionToIcon(t)}if(t in this.options.extensionToIcon){return this.options.extensionToIcon[t]}return this.options.extensionToIcon[""]||"far fa-file"}_createGrid(){let e=document.createElement("div");e.classList.add("fb-grid");this._elementsPlace=e;return e}_createPreview(){let e=document.createElement("div");e.classList.add("fb-preview");this._elementsPlace=e;return e}_createList(){let e=document.createElement("div");e.classList.add("fb-list");e.innerHTML=`
        <table>
            <thead>
                <tr>
                    <th class="fb-file-name">Name</th>
                    <th class="fb-file-size">Size</th>
                    <th class="fb-file-modified">Modified</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        `;this._elementsPlace=e.querySelector("tbody");return e}_renderFiles(){this.filelist.forEach(e=>{this._placeFile(this._renderFile(e))})}}FileBrowser.version="1.0.3";document.addEventListener("DOMContentLoaded",()=>{FileBrowser.mutationObserver.observe(document.body,{childList:true,subtree:true});FileBrowser.fromDOM(document.querySelectorAll(".fb-filebrowser"))});exports.FileBrowser=FileBrowser;if(typeof exports==="undefined"){exports=window}class FileInFileBrowser{static defaultOptions={size:0,modified:null,icon:"fa fa-file",type:"file",isDirectory:false,showFirst:false,previewUrl:null,onFileClick:null,onFileDoubleClick:null,data:null,contextMenu:null};constructor(e,t={}){t=Object.assign({},FileInFileBrowser.defaultOptions,t);this.update(t);this.filename=e;this.selected=false;this._htmlElement=null}_modifiedToDate(t){if(t===null){return null}if(typeof t==="string"||t instanceof String){if(!isNaN(t)){t=parseInt(t)}else{let e=new Date(t);if(e.toString()!=="Invalid Date"){t=e}}}if(typeof t==="number"||t instanceof Number){let e=new Date(t);if(e.toString()!=="Invalid Date"){t=e}}if(t instanceof Date){return t}return null}_setModified(e){this.modified=this._modifiedToDate(e)}compareOptions(t){for(let e in FileInFileBrowser.defaultOptions){if(t[e]!==undefined){switch(e){case"modified":if(this.modified?.getTime()!==this._modifiedToDate(t[e])?.getTime()){return false}break;default:if(this[e]!==t[e]){return false}break}}}return true}update(t={}){let i=Object.keys(FileInFileBrowser.defaultOptions);for(let e of i){if(t[e]!==undefined){switch(e){case"modified":this._setModified(t[e]);break;default:this[e]=t[e];break}}}this.isDirectory=t.isDirectory??false}select(){this.selected=true;if(this._htmlElement){this._htmlElement.classList.add("selected")}}unselect(){this.selected=false;if(this._htmlElement){this._htmlElement.classList.remove("selected")}}toggleSelect(){if(this.selected){this.unselect()}else{this.select()}}insertBefore(e){if(this._htmlElement!==null&&e._htmlElement!==null){e._htmlElement.insertAdjacentElement("beforebegin",this._htmlElement)}}insertAfter(e){if(this._htmlElement!==null&&e._htmlElement!==null){e._htmlElement.insertAdjacentElement("afterend",this._htmlElement)}}createContextMenu(){if(this.contextMenu===null){return null}let e=document.createElement("div");e.classList.add("fb-dropdown","fb-dropdown-s","fb-file-context-menu");e.innerHTML=`
            <button class="fb-dropdown-toggle" type="button">
                <i class="fa fa-ellipsis-v"></i>
            </button>`;let n=document.createElement("ul");n.classList.add("fb-dropdown-content");let o=this.contextMenu;if(o instanceof Array){o=o.reduce((e,t)=>{e[t]={};return e},{})}for(let l in o){if(l.startsWith("__")){continue}let e=document.createElement("li");let t=document.createElement("button");t.type="button";t.dataset.action=l;let i=o[l].label??l;if(o[l].icon){t.innerHTML=`<i class="${o[l].icon}"></i> ${i}`}else{t.innerText=i}let s=o[l].handler??o[l];if(s instanceof Function){t.addEventListener("click",e=>{s(this)})}e.appendChild(t);n.appendChild(e)}e.appendChild(n);new FBDropdown(e,{closeOnOutsideClick:true});return e}tableRow(){if(this._htmlElement!==null){this._htmlElement.remove()}let e=document.createElement("tr");e.innerHTML=`
            <td class="fb-file-name"><span class="fb-file-icon"><i class="${this.icon}"></i></span> ${this.filename}</td>
            <td class="fb-file-size">${toHumanSize(this.size)}</td>
            <td class="fb-file-modified">${this._modifiedStr()}</td>
        `;e.dataset.filename=btoa_utf8(this.filename);e.dataset.size=this.size;e.dataset.modified=this.modified?.getTime();e.dataset.type=this.type;if(this.selected){e.classList.add("selected")}e.addEventListener("click",e=>{if(this.onFileClick instanceof Function){this.onFileClick(this,e)}});e.addEventListener("dblclick",e=>{if(this.onFileDoubleClick instanceof Function){this.onFileDoubleClick(this,e)}});if(this.selected){e.classList.add("selected")}this._htmlElement=e;return this._htmlElement}previewElement(e=null){if(this._htmlElement!==null){this._htmlElement.remove()}let t=null;if(e instanceof Function){t=e(this)}let i=this.createContextMenu();let s=document.createElement("div");s.classList.add("fb-file-wrapper");s.innerHTML=`
            <div class="fb-file">
            </div>
        `;let l=s.querySelector(".fb-file");if(this.previewUrl!==null){l.innerHTML=`
                <div class="fb-preview-image">
                    <div class="fb-preview-image-background" style="background-image: url('${this.previewUrl}')"></div>
                    <div class="fb-preview-image-image" style="background-image: url('${this.previewUrl}')"></div>
                </div>
            `}else{l.innerHTML=`
                <div class="fb-file-icon">
                    <i class="${this.icon}"></i>
                </div>`}l.innerHTML+=`
                <div class="fb-file-details">
                    <p class="fb-file-name">${this.filename}</p>
                    <p class="fb-file-size">${toHumanSize(this.size)}</p>
                    <p class="fb-file-modified">${this._modifiedStr()}</p>
                </div>
        `;if(t!==null||i!==null){let e=document.createElement("div");e.classList.add("fb-preview-overlay");if(t!==null){e.appendChild(t)}if(i!==null){e.appendChild(i)}s.appendChild(e)}s.dataset.filename=btoa_utf8(this.filename);s.dataset.size=this.size;s.dataset.modified=this.modified?.getTime();s.dataset.type=this.type;if(this.selected){s.classList.add("selected")}this._htmlElement=s;s.addEventListener("click",e=>{if(this.onFileClick instanceof Function){this.onFileClick(this,e)}});s.addEventListener("dblclick",e=>{if(this.onFileDoubleClick instanceof Function){this.onFileDoubleClick(this,e)}});return this._htmlElement}_modifiedStr(){return this.modified===null||this.modified===undefined?"":this.modified.toLocaleString()}gridElement(e=null){if(this._htmlElement!==null){this._htmlElement.remove()}let t=null;if(e instanceof Function){t=e(this)}let i=this.createContextMenu();let s=document.createElement("div");s.classList.add("fb-file-wrapper");s.innerHTML=`
            <div class="fb-file">
                <div class="fb-file-icon">
                    <i class="${this.icon}"></i>
                </div>
                <div class="fb-file-details" title="${this.filename}">
                    <p class="fb-file-name">${this.filename}</p>
                    <p class="fb-file-size">${toHumanSize(this.size)}</p>
                    <p class="fb-file-modified">${this._modifiedStr()}</p>
                </div>
            </div>
        `;if(t!==null||i!==null){let e=document.createElement("div");e.classList.add("fb-file-overlay");if(t!==null){e.appendChild(t)}if(i!==null){e.appendChild(i)}s.appendChild(e)}s.dataset.filename=btoa_utf8(this.filename);s.dataset.size=this.size;s.dataset.modified=this.modified?.getTime();s.dataset.type=this.type;if(this.selected){s.classList.add("selected")}this._htmlElement=s;s.addEventListener("click",e=>{if(this.onFileClick instanceof Function){this.onFileClick(this,e)}});s.addEventListener("dblclick",e=>{if(this.onFileDoubleClick instanceof Function){this.onFileDoubleClick(this,e)}});return this._htmlElement}}exports.FileInFileBrowser=FileInFileBrowser;const ClassesMixin={hasClasses:function(e){if(typeof e==="string"){e=e.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}if(!Array.isArray(e)){throw new Error("Classes must be an array or a string")}return e.every(e=>this.classList.contains(e))},addClasses:function(e){if(typeof e==="string"){e=e.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}if(!Array.isArray(e)){throw new Error("Classes must be an array or a string")}e.forEach(e=>this.classList.add(e))},removeClasses:function(e){if(typeof e==="string"){e=e.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}if(!Array.isArray(e)){throw new Error("Classes must be an array or a string")}e.forEach(e=>this.classList.remove(e))}};class ResizableColumnTable{static defaultOptions={firstColumn:0,lastColumn:-1,sortableHeaders:true,classSorter:"sorter fas",classUnsorted:"fa-sort",classSorterUp:"up fa-sort-up",classSorterDown:"down fa-sort-down",onSort:(e,t)=>{}};constructor(e,t={}){this.options=Object.assign({},ResizableColumnTable.defaultOptions,t);let s=e.querySelectorAll("th");if(this.options.lastColumn<0){this.options.lastColumn=s.length+this.options.lastColumn}if(this.options.lastColumn<0||this.options.lastColumn>=s.length){throw new Error("Last column is invalid")}if(this.options.firstColumn>this.options.lastColumn){throw new Error("First column is greater than last column")}this.table=e;this.table._fbResizableTable=this;this.headers=s;this.resizers=[];let l=null;for(let i=this.options.firstColumn;i<this.options.lastColumn+1;i++){let e=s[i];let t=document.createElement("div");t.classList.add("fb-resizer");e.appendChild(t);this.resizers.push(t);this.addEventHandlers(e,t);if(l!=null){l._nextHeader=e}l=e}if(l!=null&&l!=s[s.length-1]){l._nextHeader=s[s.length-1]}if(this.options.sortableHeaders){this.addSortingIcons()}}setOrder(e,t){if(typeof e!=="number"){throw new Error("Column index must be a number")}if(e<this.options.firstColumn||e>this.options.lastColumn){throw new Error("Column index out of range")}let i=this.headers[e];let s=i.querySelector(".sorter");if(s==null){throw new Error("Column is not sortable")}s.removeClasses(this.options.classSorterUp);s.removeClasses(this.options.classSorterDown);s.addClasses(this.options.classUnsorted);if(t=="asc"){s.removeClasses(this.options.classUnsorted);s.addClasses(this.options.classSorterUp);s.removeClasses(this.options.classSorterDown)}else if(t=="desc"){s.removeClasses(this.options.classUnsorted);s.removeClasses(this.options.classSorterUp);s.addClasses(this.options.classSorterDown)}else{throw new Error("Invalid direction")}}addSortingIcons(){let e=[];if(!Array.isArray(this.options.sortableHeaders)){if(this.options.sortableHeaders===true){e=Array.from(this.headers).map((e,t)=>t)}}else{e=this.options.sortableHeaders.filter(e=>e>=0&&e<this.headers.length)}e.forEach(e=>{let t=this.headers[e];let i=document.createElement("i");Object.assign(i,ClassesMixin);i.addClasses(this.options.classSorter);i.addClasses(this.options.classUnsorted);t.addEventListener("click",e=>{t.closest("thead").querySelectorAll(".sorter").forEach(e=>{if(e!=i){e.removeClasses(this.options.classSorterUp);e.removeClasses(this.options.classSorterDown);e.addClasses(this.options.classUnsorted)}});if(i.hasClasses(this.options.classSorterUp)){i.removeClasses(this.options.classUnsorted);i.removeClasses(this.options.classSorterUp);i.addClasses(this.options.classSorterDown)}else if(i.hasClasses(this.options.classSorterDown)){i.removeClasses(this.options.classUnsorted);i.removeClasses(this.options.classSorterDown);i.addClasses(this.options.classSorterUp)}else{i.removeClasses(this.options.classUnsorted);i.addClasses(this.options.classSorterUp);i.removeClasses(this.options.classSorterDown)}if(this.options.onSort instanceof Function){this.options.onSort(t,i.hasClasses(this.options.classSorterUp)?"asc":"desc")}});t.appendChild(i)})}updateResizerHeight(){this.resizers.forEach(e=>{e.style.height=this.table.offsetHeight+"px"})}addEventHandlers(i,t){let s=0;let l=0;let n=null;let o=0;let r=e=>{let t=e.clientX-s;if(l+t<20){return}if(n!=null){n.style.width=o-t+"px";if(o-t<20){return}}i.style.width=l+t+"px"};let a=()=>{document.removeEventListener("mousemove",r);document.removeEventListener("mouseup",a);i.classList.remove("resizing");i._nextHeader?.classList.remove("resizing");t.classList.remove("resizing")};t.addEventListener("mousedown",e=>{s=e.clientX;l=parseInt(window.getComputedStyle(i).width,10);n=i._nextHeader??null;if(n!=null){o=parseInt(window.getComputedStyle(n).width,10)}document.addEventListener("mousemove",r);document.addEventListener("mouseup",a);i.classList.add("resizing");i._nextHeader?.classList.add("resizing");t.classList.add("resizing")})}}function btoa_utf8(e){return btoa(String.fromCharCode(...new TextEncoder("utf-8").encode(e)))}function atob_utf8(e){const i=atob(e);return new TextDecoder("utf-8").decode(Uint8Array.from({length:i.length},(e,t)=>i.charCodeAt(t)))}function toHumanSize(e){if(e===null||e===undefined){return""}const t=["B","KB","MB","GB","TB"];let i=0;e=parseFloat(e);if(isNaN(e)){return"0 B"}while(e>=1024&&i<t.length-1){e/=1024;i++}return`${e.toFixed(2)} ${t[i]}`}function covertCallback(callback,context=null){if(callback===null){return null}if(typeof callback==="string"){let stringCallback=callback;callback=_=>{const file=_;eval(stringCallback)}}if(callback instanceof Function){if(context!==null){return callback.bind(context)}return callback}throw new Error("Invalid callback")}function isValidURL(e){if(e instanceof URL){return true}try{new URL(e);return true}catch(e){return false}}})(window);